<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking-History VELRIDERS</title>
    <link rel="stylesheet" href="booking.css">
    <link rel="stylesheet" href="navlogin.css">
    <link rel="icon" type="image/x-icon" href="image/icon1.png">
    <link rel="stylesheet" href="fimage.css">
    <link rel="stylesheet" href="linenav.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap');
    </style>
</head>

<body>

    <nav>
        <div class="logo">
            <a href="index.html"><img src="image1/logo.jpg" alt="Logo"></a>
        </div>
        <div class="menu-icon">☰</div>
        <ul class="nav-links">
            <li><a  class="line" style="font-size: 16px;" href="index.html">Home</a></li>
            <li><a class="line" style="font-size: 16px;" href="index7.html">About</a></li>
            <li><a class="line" style="font-size: 16px;" href="index8.html">Contact Us</a></li>
            <div class="location-dropdown" style="background: rgba(128, 128, 128, 0.477);cursor: not-allowed;"
                class="location-dropdown">
                <img src="image/location.jpg" alt="location">
                <select id="city-dropdown"
                    style="background:rgba(128, 128, 128, 0); cursor: not-allowed; color:rgb(4, 4, 4);font-size:16px"
                    disabled>
                    <option value="1">Ahmedabad</option>
                    <option value="2">Jamnagar</option>
                    <option value="3">Gandhinagar</option>
                    <option value="4">Porbandar</option>
                </select>
            </div>
            <a href="index4.html" id="auth-link">
                <button id="auth-btn"
                    style="background-color: #38A4A6; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer;font-size: 14px;">Login
                    | Sign up</button>
            </a>
            <div class="profile" id="profile-menu" style="display: none;">
                <span class="profile-name" id="profile-name" style="text-transform: capitalize;">User</span>
                <img src="default-avatar.png" id="profile-img" class="profile-img" alt="Profile">
                <div class="dropdown" id="dropdown-menu">
                    <label style="background-color: #848484a4; color: white; border-radius: 5px; font-size: small;"
                        for="file-upload">Change Profile Photo</label>
                    <input type="file" id="file-upload" accept="image/*">
                    <input type="text" id="edit-name" class="edit-name" placeholder="Enter new name">
                    <button class="save-btn" id="save-name-btn">Save</button>
                    <button class="logout-btn" id="logout-btn">Logout</button>
                    <li><a style="background-color: #848484a4; color: white; border-radius: 5px;font-size: small; margin-top: 10px;text-align: center;"
                            href="booking.html">Your Booking</a></li>

                </div>
            </div>
        </ul>
    </nav>
    <br>
    <h1 id="you" style="color: #38A4A6;">Your Bookings</h1>
    <div id="bookings-container"></div>

    <br>
    <!-- footer -->
    <div id="upper1">
        <div class="upper">
            <div class="upperleft">
                <img src="image1/footerupperleftimg.png" alt="">
            </div>
            <div class="upperright">
                <h4>Do you want to stay updated on</h4>
                <h1 style="text-transform: lowercase;">exclusive email offers?</h1>
                <div class="searchbar">
                    <img src="image1/upperrightmailimg.png" alt="">
                    <input type="text" placeholder="Enter your email">
                    <button style="color: white; cursor: pointer;">Subscribe</button>
                </div>
            </div>
        </div>
    </div>
    <div class="murga">
        <div class="murgi">
            <div class="lower">
                <div class="p1">
                    <img src="image/footerleftlogo.svg" alt="">
                    <p>Rent your dream ride with Vel Riders – Cars and bikes for every adventure.</p>
                </div>
                <div class="p2">
                    <h2><a
                            style="background-color: transparent; text-decoration: none;font-size: 24px;color: white;font-weight: 500;">helpful
                            link</a></h2>
                    <h5><a style="background-color: transparent; text-decoration: none;color: white;font-weight: 300;"
                            href="index.html">Home</a></h5>
                    <h5><a style="background-color: transparent; text-decoration: none;color: white;font-weight:300"
                            href="index7.html">About</a>
                    </h5>
                    <h5><a style="background-color: transparent; text-decoration: none;color: white;font-weight:300"
                            href="index8.html">Contact</a>
                    </h5>
                    <h5><a style="background-color: transparent; text-decoration: none;color: white;font-weight:300"
                            href="Privacy-Policy.html">Privacy Policy</a></h5>
                    <h5><a style="background-color: transparent; color: white; text-decoration: none;font-weight:300"
                            href="terms.html">Terms & Condition</a></h5>
                </div>
                <div class="p3">
                    <h2 style="color: white; font-size: 24px;font-weight: 500;">get in touch</h2>
                    <div class="leftfooter">
                        <img src="image1/footerlogo.png" alt="" class="img1">
                        <a href="https://www.google.com/maps/search/OFFICE+NO.+215,+Iscon+Emporio,+Satellite+Rd,+beside+Star+Bazar+BRTS+Bus+Stop,+Satellite,+Ahmedabad,+Gujarat+380015/@23.0268595,72.512787,15z/data=!3m1!4b1?entry=ttu&g_ep=EgoyMDI1MDIyNi4xIKXMDSoASAFQAw%3D%3D"
                            style="text-decoration: none;background-color: transparent;color: white;">
                            <p>SHOP NO.232, Someshwar Complex, BRTS STOP, Satellite Rd, opp. Iscon Emporio, nr Star
                                Bazaar, Satellite, Ahmedabad, Gujarat 380015</p>
                        </a>
                    </div>
                    <div class="leftfooter">
                        <img src="image1/footermail.png" alt="" class="img2">
                        <p>info@velriders.com</p>
                    </div>
                    <div class="leftfooter">
                        <img src="image/footercall2.svg" alt="" class="img3">
                        <p>082382 24282</p>
                    </div>
                </div>
            </div>
            <div class="boder">
                <div class="lastfooter">
                    <div class="lastfooterleft">
                        <a target="_blank" href="https://www.facebook.com/shaileshcarbike" style="background-color: transparent;">
                            <div class="circle">
                                <img src="image/facebookfinal.svg" alt="">
                            </div>
                        </a>
                        <a target="_blank" href="" style="background-color: transparent;">
                            <div class="circle">
                                <img src="image/twiteerfinal.svg" alt="">
                            </div>
                        </a>
                        <a target="_blank" href="https://www.instagram.com/velriders/" style="background-color: transparent;">
                            <div class="circle">
                                <img src="image/instagramfinal.svg" alt="">
                            </div>
                        </a>

                        <a target="_blank" href="" style="background-color: transparent;">
                            <div class="circle">
                                <img src="image/instafinal.svg" alt="">
                            </div>
                        </a>
                    </div>
                    <div class="lastfooterright">
                        <p>download the app by clicking the link below: </p>
                        <div>
                            <a style="background: transparent;"
                                href="https://play.google.com/store/apps/details?id=com.imd.velriders"><img
                                    src="image/image 1.svg" alt=""></a>
                            <img src="image/image 2.svg" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="loader-overlay" id="loader-overlay">
        <div class="loader"></div>
    </div>
    <script>
        function getUrlParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);

            return urlParams.get(name);
        }

        async function fetchBookings() {
            const loader = document.getElementById('loader-overlay');


            loader.style.display = 'flex';

            const userId = localStorage.getItem('userId') || getUrlParameter('userId');
            const token = localStorage.getItem('token');
            if (!userId || !token) {
                alert('Please log in to view your bookings.');
                window.location.href = 'index4.html';
                loader.style.display = 'none';
                return;
            }

            try {
                const response = await fetch(`http://localhost:3000/bookings/${userId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();

                const container = document.getElementById('bookings-container');
                container.innerHTML = '';

                if (data.success && data.bookings.length > 0) {
                    const reversedBookings = data.bookings.reverse();

                    for (const booking of reversedBookings) {
                        const vehicleResponse = await fetch(`https://velriders.com/api/vehicle-details?vehicle_id=${booking.vehicleId}`);
                        const vehicleData = await vehicleResponse.json();
                        const vehicle = vehicleData.data || { vehicle_name: 'Unknown Vehicle', cutout_image: 'image/thar.png' };

                        const bookingCard = `
                    <div class="booking-card">
                        <img src="${vehicle.cutout_image}" alt="Car Image" class="car-image">
                        <div class="booking-details">
                            <h2>#${booking.vehicleId} ${vehicle.vehicle_name}</h2>
                            <span class="status ${booking.status.toLowerCase()}">${booking.status}</span>
                            <div class="date-time">
                                <div class="time-block">
                                    <p class="date">${booking.fromDate}</p>
                                    <p class="time">${booking.fromTime}</p>
                                </div>
                                <span class="duration">${calculateDuration(booking.fromDate, booking.fromTime, booking.toDate, booking.toTime)}</span>
                                <div class="time-block">
                                    <p class="date">${booking.toDate}</p>
                                    <p class="time">${booking.toTime}</p>
                                </div>
                            </div>
                            <p class="status-message">
                                ${booking.status === 'Pending' ? 'Your booking is currently payment pending approval. Please wait for confirmation.' : 'Your booking is confirmed! Enjoy your ride.'}
                            </p>
                        </div>
                    </div>
                `;
                        container.innerHTML += bookingCard;
                    }
                } else {
                    container.innerHTML = '<p>No bookings found.</p>';
                }
            } catch (error) {
                console.error('Error fetching bookings:', error);
                container.innerHTML = '<p>Error loading bookings. Please try again later.</p>';
            } finally {
                loader.style.display = 'none';
            }
        }

        function calculateDuration(fromDate, fromTime, toDate, toTime) {
            const start = new Date(`${fromDate} ${fromTime}`);
            const end = new Date(`${toDate} ${toTime}`);
            const diffMs = end - start;
            const hours = Math.floor(diffMs / (1000 * 60 * 60));
            return `${hours}hrs`;
        }

        const menuIcon = document.querySelector('.menu-icon');
        const navLinks = document.querySelector('.nav-links');
        menuIcon.addEventListener('click', () => {
            navLinks.classList.toggle('active');
        });

        window.addEventListener('load', fetchBookings);

        window.addEventListener('load', function () {
            const cityDropdown = document.getElementById('city-dropdown');

            const savedCityId = localStorage.getItem('selectedCityId');
            const savedCityName = localStorage.getItem('selectedCityName');

            if (savedCityId && savedCityName) {
                let cityExists = false;
                for (let option of cityDropdown.options) {
                    if (option.value === savedCityId) {
                        option.selected = true;
                        cityExists = true;
                        break;
                    }
                }

                if (!cityExists) {
                    const newOption = document.createElement('option');
                    newOption.value = savedCityId;
                    newOption.textContent = savedCityName;
                    newOption.selected = true;
                    cityDropdown.appendChild(newOption);
                }
            }

            cityDropdown.addEventListener('change', function () {
                const selectedCityId = this.value;
                const selectedCityName = this.options[this.selectedIndex].text;
                localStorage.setItem('selectedCityId', selectedCityId);
                localStorage.setItem('selectedCityName', selectedCityName);
            });
        });
    </script>
    <script src="profile.js"></script>
</body>

</html>